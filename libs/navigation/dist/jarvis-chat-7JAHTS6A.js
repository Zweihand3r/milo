import"./chunk-YBWLHNHN.js";var w=!1,g,u,d,y=e=>e["event.workflow"]==="init"&&e["event.type"]==="request"||e["event.workflow"]==="Chat"&&e["event.type"]==="load"&&e["event.subtype"]==="window",v=e=>({chatConversationId:e["event.context_guid"],chatConversationSessionId:e["event.session_guid"],chatWorkflow:e["event.workflow"],chatCategory:e["event.category"],chatSubcategory:e["event.subcategory"],chatType:e["event.type"],chatSubtype:e["event.subtype"],chatUserguid:e["event.user_guid"],chatLanguage:e["event.language"],chatPagename:e["event.pagename"],chatVisitorguid:e["event.visitor_guid"],chatUrl:e["event.url"],chatOrgguid:e["event.org_guid"],chatReferrer:e["event.referrer"],chatClientId:e["source.client_id"],chatSourceName:e["source.name"],chatPlatform:e["source.platform"],chatContentName:e["content.name"],chatEnv:e["env.com.name"]}),m=e=>{let t={variationId:e["exp.variation_id"],actionBlockId:e["exp.action_block_id"],campaignId:e["exp.campaign_id"],containerId:e["exp.container_id"],controlGroupId:e["exp.control_group_id"],treatmentId:e["exp.treatment_id"],surfaceId:e["exp.surface_id"]};Object.keys(t).forEach(a=>{t[a]||delete t[a]}),!(!Object.keys(t).length||(a=>{let o=!1;if(!a)return o;let i=window.digitalData.sophiaResponse?.fromPage;return Array.isArray(i)?o=i.some(r=>r?.campaignId===a):o=i?.campaignId===a,o})(t.campaignId))&&(window.digitalData.sophiaResponse||={},window.digitalData.sophiaResponse.fromPage||=[],Array.isArray(window.digitalData.sophiaResponse.fromPage)?window.digitalData.sophiaResponse.fromPage.push(t):window.digitalData.sophiaResponse.fromPage=t)},l=e=>{m(e),window._satellite?.track("event",{xdm:{},data:{web:{webInteraction:{name:window.digitalData.primaryEvent?.eventInfo?.eventName}},_adobe_corpnew:{digitalData:{primaryEvent:window.digitalData.primaryEvent,chat:window.digitalData.chat,sophiaResponse:window.digitalData.sophiaResponse}}}})},s=(e,t=[])=>t.reduce((c,a)=>{let o=c;return o+=`${o&&":"}${e[a]||""}`,o},""),f=e=>{window.digitalData.primaryEvent={eventInfo:{eventName:`chat:${s(e,["event.workflow","event.subcategory","event.subtype","content.name","event.type"])}`,eventAction:s(e,["event.subcategory","content.name","event.type"])}},window.digitalData.chat={},window.digitalData.chat.chatInfo=v(e),window.digitalData.chat.chatInfo.chatConversationUnread=e["content.name"],l(e)},b=e=>{window.digitalData.primaryEvent={eventInfo:{eventName:`chat:${s(e,["event.workflow","event.subcategory","event.subtype","content.name","event.type"])}`,eventAction:s(e,["event.subcategory","event.subtype","content.name","event.type"])}},window.digitalData.chat={},window.digitalData.chat.chatInfo=v(e),window.digitalData.chat.chatInfo.chatConversationUnread=e["content.name"],l(e)},I=e=>{window.digitalData.primaryEvent={eventInfo:{eventName:`chat:${s(e,["event.workflow","content.name","event.subtype","event.type"])}`,eventAction:s(e,["event.subcategory","content.name","event.subtype","event.type"])}},window.digitalData.chat={chatInfo:{primaryProduct:{productName:e["event.subtype"]}}},l(e)},D=e=>{window.digitalData.primaryEvent={eventInfo:{eventName:`chat:${s(e,["event.workflow","content.name","event.subtype","event.type","content.id"])}`,eventAction:s(e,["event.subcategory","content.name","event.subtype","event.type"])}},l(e)},C=e=>{window.digitalData.primaryEvent={eventInfo:{eventName:`chat:${s(e,["event.workflow","event.subtype","event.type"])}:error`,eventAction:`${s(e,["event.subcategory","event.subtype","event.type"])}:error`}},window.digitalData.chat={},window.digitalData.chat.chatInfo=v(e),window.digitalData.chat.chatInfo.chatErrorCode=e["event.error_code"],window.digitalData.chat.chatInfo.chatErrorType=e["event.error_type"],window.digitalData.chat.chatInfo.chatErrorDescription=e["event.error_desc"],l(e)},k=e=>{window.digitalData.primaryEvent={eventInfo:{eventName:`chat:${s(e,["event.workflow","content.name","event.subtype","event.type"])}`,eventAction:s(e,["event.subcategory","content.name","event.subtype","event.type"])}},window.digitalData.chat={},window.digitalData.chat.chatInfo=v(e),l(e)},E=()=>window.location.assign("https://helpx.adobe.com"),_=()=>{let e=window.AdobeMessagingExperienceClient;return e?.isAdobeMessagingClientInitialized()&&e?.getMessagingExperienceState()?.windowState!=="hidden"},h=e=>{w||E();let t=window.AdobeMessagingExperienceClient?.openMessagingWindow;if(!(typeof t!="function"||_()))if(e){let c=e.target.tagName?.toLowerCase(),a=c==="img"?e.target.alt?.trim():e.target.innerText?.trim();t({sourceType:c,sourceText:a})}else t({})},p=async(e,t,c)=>{let a=`https://${e.env.name!=="prod"?"stage-":""}client.messaging.adobe.com/latest/AdobeMessagingClient`;await Promise.all([u(`${a}.css`),g(`${a}.js`)]);let o,i;e.locale.ietf.includes("-")?[o,i]=e.locale.ietf.split("-"):([i,o]=e.locale.prefix.replace("/","").split("_"),i==="africa"&&(i="ZA")),window.AdobeMessagingExperienceClient.initialize({appid:d("jarvis-surface-id")||e.jarvis.id,appver:d("jarvis-surface-version")||e.jarvis.version,env:e.env.name!=="prod"?"stage":"prod",clientId:window.adobeid?.client_id,accessToken:window.adobeIMS?.isSignedInUser()?`Bearer ${window.adobeIMS.getAccessToken()?.token}`:void 0,lazyLoad:!0,loadedVia:"milo",language:o||"en",region:i,cookiesEnabled:window.adobePrivacy?.activeCookieGroups()?.length>1,cookies:{mcid:window.alloy?await window.alloy("getIdentity").then(r=>r?.identity?.ECID).catch(()=>{}):void 0},callbacks:{initCallback:r=>{w=!!r?.releaseControl?.showAdobeMessaging},onReadyCallback:()=>{c&&h(t)},initErrorCallback:()=>{},chatStateCallback:()=>{},getContextCallback:()=>{},signInProvider:()=>window.adobeIMS?.signIn(e.signInContext),analyticsCallback:r=>{if(!window.alloy_all||!window.digitalData)return;let n=r?.events?.[0]?.data;if(!(!n||y(n))){if(n["event.subcategory"]?.toLowerCase()==="launch"&&n["event.workflow"]?.toLowerCase()==="init"){if(n["event.type"]?.toLowerCase()==="render"){f(n);return}if(n["event.type"]?.toLowerCase()==="click"){b(n);return}}if(n["content.name"]?.toLowerCase()==="auth-subproduct"){I(n);return}if(n["content.name"]?.toLowerCase()==="5-star-survey"){D(n);return}if(n["event.error_code"]&&n["event.error_type"]){C(n);return}k(n)}}}})},x=async(e,t,c,a)=>{if(!e?.jarvis)return;g=t,u=c,d=a;let o=d("jarvis-on-demand")?.toLowerCase(),i=o?o==="on":e.jarvis.onDemand;document.addEventListener("click",async r=>{r.target.closest('[href*="#open-jarvis-chat"]')&&(r.preventDefault(),i&&!w?await p(e,r,i):h(r))}),i||await p(e)};export{x as initJarvisChat,h as openChat};
