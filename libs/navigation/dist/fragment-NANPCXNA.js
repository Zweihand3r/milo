import{E as y,f as R,h as v,i as d,v as b}from"./chunk-7TJA6U3A.js";import"./chunk-YBWLHNHN.js";var m={},A=t=>{let e=t.split("#")[0];return t.includes("#_dnt")?`${e}#_dnt`:e},F=t=>[...Object.values(m)].some(e=>e.find(t)?.isRecursive),H=(t,e,n)=>{let r=[...t.querySelectorAll("a")].filter(i=>d(i.href).includes("/fragments/"));r.length&&(document.body.contains(e)&&!e.parentElement?.closest(".fragment")?(m[n]=new E(n),r.forEach(i=>m[n].insert(n,d(A(i.href))))):Object.values(m).forEach(i=>{let s=i.find(n);s&&r.forEach(a=>{let c=d(A(a.href)),f=s.findParent(c);f?f.isRecursive=!0:s.addChild(c)})}))},P=(t,e,n,r,i)=>{let s=[...t[0].children];e.parentElement.nodeName==="DIV"&&!e.parentElement.attributes.length?e.parentElement.replaceWith(...s):e.replaceWith(...s),s.forEach(a=>{a.setAttribute("data-path",n),i&&(r.commands=i(r.commands,a))})};function $(t,e){let n=(r,i)=>{e.querySelectorAll(`${r}[${i}^="./media_"]`).forEach(s=>{s[i]=new URL(s.getAttribute(i),new URL(t,window.location)).href})};n("img","src"),n("source","srcset")}async function L(t){let{decorateArea:e,mep:n}=R(),r=d(t.href),i=!1;if(t.parentElement?.nodeName==="P"){let o=t.parentElement.childNodes,w=v("div");for(let C of t.parentElement.attributes)w.setAttribute(C.name,C.value);t.parentElement.replaceWith(w),w.append(...o)}t.href.includes("#_inline")&&(i=!0,t.href=t.href.replace("#_inline",""),r=r.replace("#_inline",""));let s=new URL(t.href).pathname;if(n?.fragments?.[s]){let{handleFragmentCommand:o}=await import("./personalization-2URMSQ4C.js");if(r=o(n?.fragments[s],t),!r)return}if(F(r)){window.lana?.log(`ERROR: Fragment Circular Reference loading ${t.href}`);return}let a=t.href;if(t.href.includes("/federal/")){let{getFederatedUrl:o}=await import("./federated-IXQVIO4C.js");a=o(t.href)}let c=await b({resource:`${a}.plain.html`,withCacheRules:!0}).catch(()=>({}));if(!c?.ok){window.lana?.log(`Could not get fragment: ${a}.plain.html`);return}let f=await c.text(),g=new DOMParser().parseFromString(f,"text/html");$(t.href,g),e&&e(g,{fragmentLink:t});let h=g.querySelectorAll("body > div");if(!h.length){window.lana?.log(`Could not make fragment: ${a}.plain.html`);return}let l=v("div",{class:"fragment","data-path":r});if(i||l.append(...h),H(l,t,r),t.dataset.manifestId||t.dataset.adobeTargetTestid){let{updateFragDataProps:o}=await import("./personalization-2URMSQ4C.js");o(t,i,h,l)}let u=!1;if(n?.commands?.length){let{handleCommands:o}=await import("./personalization-2URMSQ4C.js");u=o}i?P(h,t,r,n,u):(t.parentElement.replaceChild(l,t),u&&u(n?.commands,l),await y(l))}var p=class t{constructor(e,n=e,r=null){this.key=e,this.value=n,this.parent=r,this.children=[],this.isRecursive=!1}addChild(e,n=e){this.children.some(i=>i.key===e)||this.children.push(new t(e,n,this))}findParent(e){return this.parent?.key===e?this.parent:this.parent?.findParent(e)}},E=class{constructor(e,n=e){this.root=new p(e,n)}*traverse(e=this.root){if(yield e,e.children.length)for(let n of e.children)yield*this.traverse(n)}insert(e,n,r=n){for(let i of this.traverse())if(i.key===e)return i.children.push(new p(n,r,i)),!0;return!1}remove(e){for(let n of this.traverse()){let r=n.children.filter(i=>i.key!==e);if(r.length!==n.children.length)return n.children=r,!0}return!1}find(e){for(let n of this.traverse())if(n.key===e)return n}};export{E as Tree,L as default};
