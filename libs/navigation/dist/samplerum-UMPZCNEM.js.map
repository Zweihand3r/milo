{
  "version": 3,
  "sources": ["../../utils/samplerum.js"],
  "sourcesContent": ["// code from https://github.com/adobe/helix-rum-js/blob/main/src/index.js\n// eslint-disable-next-line import/prefer-default-export\nexport function sampleRUM(checkpoint, data) {\n  // eslint-disable-next-line max-len\n  const timeShift = () => (window.performance ? window.performance.now() : Date.now() - window.hlx.rum.firstReadTime);\n  try {\n    window.hlx = window.hlx || {};\n    sampleRUM.enhance = () => {};\n    if (!window.hlx.rum) {\n      const param = new URLSearchParams(window.location.search).get('rum');\n      const weight = (window.SAMPLE_PAGEVIEWS_AT_RATE === 'high' && 10)\n        || (window.SAMPLE_PAGEVIEWS_AT_RATE === 'low' && 1000)\n        || (param === 'on' && 1)\n        || 100;\n      const id = Math.random().toString(36).slice(-4);\n      const isSelected = (param !== 'off') && (Math.random() * weight < 1);\n      // eslint-disable-next-line object-curly-newline, max-len\n      window.hlx.rum = { weight, id, isSelected, firstReadTime: window.performance ? window.performance.timeOrigin : Date.now(), sampleRUM, queue: [], collector: (...args) => window.hlx.rum.queue.push(args) };\n      if (isSelected) {\n        const dataFromErrorObj = (error) => {\n          const errData = { source: 'undefined error' };\n          try {\n            errData.target = error.toString();\n            errData.source = error.stack.split('\\n')\n              .filter((line) => line.match(/https?:\\/\\//)).shift()\n              .replace(/at ([^ ]+) \\((.+)\\)/, '$1@$2')\n              .replace(/ at /, '@')\n              .trim();\n          } catch (err) { /* error structure was not as expected */ }\n          return errData;\n        };\n\n        window.addEventListener('error', ({ error }) => {\n          const errData = dataFromErrorObj(error);\n          sampleRUM('error', errData);\n        });\n\n        window.addEventListener('unhandledrejection', ({ reason }) => {\n          let errData = {\n            source: 'Unhandled Rejection',\n            target: reason || 'Unknown',\n          };\n          if (reason instanceof Error) {\n            errData = dataFromErrorObj(reason);\n          }\n          sampleRUM('error', errData);\n        });\n\n        sampleRUM.baseURL = sampleRUM.baseURL || new URL(window.RUM_BASE || '/', new URL('https://rum.hlx.page'));\n        sampleRUM.collectBaseURL = sampleRUM.collectBaseURL || sampleRUM.baseURL;\n        sampleRUM.sendPing = (ck, time, pingData = {}) => {\n          // eslint-disable-next-line max-len, object-curly-newline\n          const rumData = JSON.stringify({ weight, id, referer: window.location.href, checkpoint: ck, t: time, ...pingData });\n          const urlParams = window.RUM_PARAMS ? `?${new URLSearchParams(window.RUM_PARAMS).toString()}` : '';\n          const { href: url, origin } = new URL(`.rum/${weight}${urlParams}`, sampleRUM.collectBaseURL);\n          const body = origin === window.location.origin ? new Blob([rumData], { type: 'application/json' }) : rumData;\n          navigator.sendBeacon(url, body);\n          // eslint-disable-next-line no-console\n          console.debug(`ping:${ck}`, pingData);\n        };\n        sampleRUM.sendPing('top', timeShift());\n\n        sampleRUM.enhance = () => {\n          // only enhance once\n          if (document.querySelector('script[src*=\"rum-enhancer\"]')) return;\n\n          const script = document.createElement('script');\n          script.src = new URL('.rum/@adobe/helix-rum-enhancer@^2/src/index.js', sampleRUM.baseURL).href;\n          document.head.appendChild(script);\n        };\n        if (!window.hlx.RUM_MANUAL_ENHANCE) {\n          sampleRUM.enhance();\n        }\n      }\n    }\n    if (window.hlx.rum && window.hlx.rum.isSelected && checkpoint) {\n      window.hlx.rum.collector(checkpoint, data, timeShift());\n    }\n    document.dispatchEvent(new CustomEvent('rum', { detail: { checkpoint, data } }));\n  } catch (error) {\n    // something went awry\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
