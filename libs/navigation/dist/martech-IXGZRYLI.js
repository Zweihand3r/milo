import{A as h,c as p,f as m,j as g,n as f,z as w}from"./chunk-VP5VJMKQ.js";import"./chunk-YBWLHNHN.js";var d="alloy_sendEvent",L="alloy_sendEvent_error",_=4e3,k=3e3,E=(e,n,a)=>{let t=n.split("."),i=e;for(let o of t.slice(0,-1))(!i[o]||typeof i[o]!="object")&&(i[o]={}),i=i[o];i[t[t.length-1]]=a},u=(e,n,a)=>new Promise(t=>{let i=s=>{clearTimeout(r),t(s.detail)},o=()=>{clearTimeout(r),t({error:!0})},r=setTimeout(()=>{window.removeEventListener(e,i),t(a!==void 0?a:{timeout:!0})},n);window.addEventListener(e,i,{once:!0}),window.addEventListener(L,o,{once:!0})}),I=e=>{let n=(e.propositions?.length&&e.propositions||e.decisions?.length&&e.decisions||[]).map(a=>a.items).flat();return n?.length?n.map(a=>{let t=a?.data?.content;return!t||!(t.manifestLocation||t.manifestContent)?null:{manifestPath:t.manifestLocation||t.manifestPath,manifestUrl:t.manifestLocation,manifestData:t.manifestContent?.experiences?.data||t.manifestContent?.data,manifestPlaceholders:t.manifestContent?.placeholders?.data,manifestInfo:t.manifestContent?.info.data,name:a.meta["activity.name"],variantLabel:a.meta["experience.name"]&&`target-${a.meta["experience.name"]}`,meta:a.meta}}).filter(Boolean):[]};function y(e){return Math.ceil(e/250)/4}function v(e){let n=Date.now()-e;return y(n)}function T(e,n,a,t){let i=v(n),o=y(a),r=`target response time ${i}:timed out ${e}:timeout ${o}`;t&&(r+=`:${t}`),window._satellite?.track?.("event",{documentUnloading:!0,xdm:{eventType:"web.webinteraction.linkClicks",web:{webInteraction:{linkClicks:{value:1},type:"other",name:r}}},data:{_adobe_corpnew:{digitalData:{primaryEvent:{eventInfo:{eventName:r}}}}}})}var D=async()=>{let e=new URL(window.location.href).searchParams,n=parseInt(e.get("target-timeout"),10)||parseInt(p("target-timeout"),10)||_,a=Date.now();window.addEventListener(d,()=>{let r=v(a);try{window.lana.log(`target response time: ${r}`,{tags:"martech",errorType:"i"})}catch(s){console.error("Error logging target response time:",s)}},{once:!0});let t=[],i=[],o=await u(d,n);if(o.error){try{window.lana.log("target response time: ad blocker",{tags:"martech",errorType:"i"})}catch(r){console.error("Error logging target response time for ad blocker:",r)}return{targetManifests:t,targetPropositions:i}}return o.timeout?u(d,5100-n).then(()=>T(!0,a,n)):(T(!1,a,n),t=I(o.result),i=o.result?.propositions||[]),{targetManifests:t,targetPropositions:i}},b=()=>{let e=async o=>{let{getEntitlements:r}=await import("./personalization-ZOVAUKXO.js");return r(o)},n=o=>{let r=s=>{s?.result?.destinations?.length?o(e(s.result.destinations)):o([])};u(d,k,[]).then(r).catch(()=>o([]))},{miloLibs:a,codeRoot:t,entitlements:i}=m();n(i),g(`${a||t}/features/personalization/personalization.js`,{as:"script",rel:"modulepreload"})};function c(){return/^(www|milo|business|blog)(\.stage)?\.adobe\.com$/.test(window.location.hostname)}var l=!1,C=async e=>l||(l=async()=>{w("xlg")==="loggedout"?b():h().then(()=>{window.adobeIMS.isSignedInUser()&&b()}).catch(()=>{}),E(window,"alloy_all.data._adobe_corpnew.digitalData.page.pageInfo.language",{locale:e.locale.prefix.replace("/",""),langCode:e.locale.ietf}),E(window,"digitalData.diagnostic.franklin.implementation","milo");let n=e.env.consumer?.marTechUrl||(c()?"/marketingtech":"https://assets.adobedtm.com")+(e.env.name==="prod"?"/d4d114c60e50/a0e989131fd5/launch-5dd5dd2177e6.min.js":"/d4d114c60e50/a0e989131fd5/launch-2c94beadc94f-development.min.js");g(n,{as:"script",rel:"preload"}),window.marketingtech={adobe:{launch:{url:n,controlPageLoad:!0},alloy:{edgeConfigId:e.env.consumer?.edgeConfigId||e.env.edgeConfigId,edgeDomain:c()?window.location.hostname:"sstats.adobe.com",edgeBasePath:c()?"experienceedge":"ee"},target:!1},milo:!0},window.edgeConfigId=e.env.edgeConfigId,await f((c()?"":"https://www.adobe.com")+(e.env.name==="prod"?"/marketingtech/main.standard.min.js":"/marketingtech/main.standard.qa.min.js")),window._satellite.track("pageload")},await l(),l);async function P(){let e=m();return C(e)}export{P as default,D as getTargetPersonalization};
