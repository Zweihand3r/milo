import{a as D}from"./chunk-XA4S2AUY.js";import{c as w,f as F}from"./chunk-VP5VJMKQ.js";import"./chunk-YBWLHNHN.js";var B="0123456789abcdef".split(""),Q=async e=>{let t=new TextEncoder().encode(e);return await crypto.subtle.digest("SHA-1",t)},b=e=>{let t=e>>4,a=e-(t<<4);return B[t]+B[a]},I=e=>[...e].map(t=>b(t)).join(""),K=e=>[I(e.slice(0,4)),"-",I(e.slice(4,6)),"-",b(e[6]&15|parseInt(5*10,16)),b(e[7]),"-",b(e[8]&63|128),b(e[9]),"-",I(e.slice(10,16))].join(""),J=async e=>{let t=await Q(e);return K(new Uint8Array(t))},S=J;var x={ar:{ietf:"es-AR"},br:{ietf:"pt-BR"},ca:{ietf:"en-CA"},ca_fr:{ietf:"fr-CA"},cl:{ietf:"es-CL"},co:{ietf:"es-CO"},cr:{ietf:"es-CR"},ec:{ietf:"es-EC"},el:{ietf:"es-EL"},gt:{ietf:"es-GT"},la:{ietf:"es-LA"},mx:{ietf:"es-MX"},pe:{ietf:"es-PE"},pr:{ietf:"es-PR"},"":{ietf:"en-US"},langstore:{ietf:"en-US"},africa:{ietf:"en-africa"},be_fr:{ietf:"fr-BE"},be_en:{ietf:"en-BE"},be_nl:{ietf:"nl-BE"},cy_en:{ietf:"en-CY"},dk:{ietf:"da-DK"},de:{ietf:"de-DE"},ee:{ietf:"et-EE"},eg_ar:{ietf:"ar-EG"},eg_en:{ietf:"en-GB"},es:{ietf:"es-ES"},fr:{ietf:"fr-FR"},gr_en:{ietf:"en-GR"},gr_el:{ietf:"el-GR"},ie:{ietf:"en-IE"},il_en:{ietf:"en-IL"},il_he:{ietf:"he-il"},it:{ietf:"it-IT"},kw_ar:{ietf:"ar-KW"},kw_en:{ietf:"en-GB"},lv:{ietf:"lv-LV"},lt:{ietf:"lt-LT"},lu_de:{ietf:"de-LU"},lu_en:{ietf:"en-LU"},lu_fr:{ietf:"fr-LU"},hu:{ietf:"hu-HU"},mt:{ietf:"en-MT"},mena_en:{ietf:"en-mena"},mena_ar:{ietf:"ar-mena"},ng:{ietf:"en-NG"},nl:{ietf:"nl-NL"},no:{ietf:"no-NO"},pl:{ietf:"pl-PL"},pt:{ietf:"pt-PT"},qa_ar:{ietf:"ar-QA"},qa_en:{ietf:"en-GB"},ro:{ietf:"ro-RO"},sa_en:{ietf:"en-sa"},ch_fr:{ietf:"fr-CH"},ch_de:{ietf:"de-CH"},ch_it:{ietf:"it-CH"},si:{ietf:"sl-SI"},sk:{ietf:"sk-SK"},fi:{ietf:"fi-FI"},se:{ietf:"sv-SE"},tr:{ietf:"tr-TR"},ae_en:{ietf:"en-ae"},uk:{ietf:"en-GB"},at:{ietf:"de-AT"},cz:{ietf:"cs-CZ"},bg:{ietf:"bg-BG"},ru:{ietf:"ru-RU"},ua:{ietf:"uk-UA"},ae_ar:{ietf:"ar-ae"},sa_ar:{ietf:"ar-sa"},za:{ietf:"en-ZA"},au:{ietf:"en-AU"},hk_en:{ietf:"en-HK"},in:{ietf:"en-in"},id_id:{ietf:"id-id"},id_en:{ietf:"en-id"},my_ms:{ietf:"ms-my"},my_en:{ietf:"en-my"},nz:{ietf:"en-nz"},ph_en:{ietf:"en-ph"},ph_fil:{ietf:"fil-PH"},sg:{ietf:"en-SG"},th_en:{ietf:"en-th"},in_hi:{ietf:"hi-in"},th_th:{ietf:"th-th"},cn:{ietf:"zh-CN"},hk_zh:{ietf:"zh-HK"},tw:{ietf:"zh-TW"},jp:{ietf:"ja-JP"},kr:{ietf:"ko-KR"},vn_en:{ietf:"en-vn"},vn_vi:{ietf:"vi-VN"}};var Z=F(),Be=Object.keys(Z.locales||{});var X="https://www.adobe.com/chimera-api/tags",Y="https://admin.hlx.page/status",ee="https://14257-milocaasproxy.adobeio-static.net/api/v1/web/milocaas/postXDM",te=/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_+.~#?&//=]*)/,ae=/fragments(.*)#[a-zA-Z0-9_-]+$/,oe=/(\s*\S+\s*:\s*\S+\s*)/,ne=e=>te.test(e),U=e=>ae.test(e),[$,d]=(()=>{let e={isInjectedDoc:()=>(void 0).doc!==document,doc:document};return[t=>(e={...e,...t},e),()=>e]})(),re=e=>e?e.split(",").filter(t=>t.length).filter(t=>oe.test(t)).map(t=>{let[a,...n]=t.split(":");return{[a.trim()]:n.join(":").trim()}}):[],j=e=>{if(e.startsWith("http"))return e;let{host:t}=d();return`https://${t}${e.startsWith("/")?"":"/"}${e}`},C=(e,t)=>{let a=d().doc.querySelector(`meta[${e}='${t}']`);if(a)return a.content},ie=e=>e?.startsWith("https://")||e?.startsWith("http://")?e:`https://${e}`,se=e=>{let t=document.createElement("div");return t.innerHTML=e,t.querySelector("a").getAttribute("href")},T=(e,t)=>{if(e===void 0||U(e))return e;let a=e.includes("href=")?se(e):e;return U(a)?a:ne(a)?ie(a):{error:t}},A=(e,t,a=[])=>{let n=[],r=Object.values(e).find(o=>a.includes(o.title)||a.includes(o.name)||a.includes(o.path)||a.includes(o.tagID)?!1:(o.tags&&Object.keys(o.tags).length&&n.push(o.tags),!![o.title.toLowerCase(),o.name,o.path,o.path.replace("/content/cq:tags/",""),o.tagID.toLowerCase()].includes(t.toLowerCase())));return r||n.some(o=>(r=A(o,t,a),r)),r},[le,_]=(()=>{let e;return[()=>e,async()=>{try{let a=await fetch(X);if(a.ok){e=(await a.json()).namespaces.caas.tags;return}}catch{}let{default:t}=await import("./caas-tags-ITSJMGIA.js");e=t.namespaces.caas.tags}]})(),N=(e,t)=>{if(!e)return;let a=le(),n=A(a,e,["Events"])||A(a.events.tags,e,[]);return n||t.push(e),n},ce=e=>{let t=[];e&&(t=e.toLowerCase().split(/,|(\s+)|(\\n)|;/g).filter(o=>o&&o.trim()&&o!==`
`));let a=[],n=t.map(o=>N(o,a)).filter(o=>o!==void 0).map(o=>o.tagID),r=[...new Set(n)].map(o=>({id:o}));return{tagErrors:a,tags:r}},m=(e,t)=>{if(e)try{let a=new Date(e);return a.getFullYear()<2e3?{error:`${t} - Date is before the year 2000`}:a.toISOString()}catch{return{error:t}}},M=(e,t)=>e&&t&&t!=="default"?e.slice(0,e.lastIndexOf(`-${t}`)):e,de=e=>{let{project:t,repo:a}=d(),n=t||M(a,e),o={cc:"hawks",dc:"doccloud"}[n.toLowerCase()]||n;if(o)return o;if(window.location.hostname.endsWith(".hlx.page")){let[,i]=window.location.hostname.split(".")[0].split("--");return M(i,e)}throw new Error("No Project or Repo defined in config")},ue=e=>`${e.split("/").slice(0,-1).join("/")}/`,L=e=>{let t=d().doc.querySelector(".card-metadata");if(!t)return null;let a="";return[...t.children].some(n=>{if(n.firstElementChild.textContent?.trim().toLowerCase()!==e)return!1;let o=n.lastElementChild.querySelector("img");if(o){let i=o.src;if(d().bulkPublish){let s=o.attributes.src.value;s.startsWith("./")?i=`${ue(d().pageUrl)}${s}`:s.startsWith("/")?i=`${new URL(d.pageUrl.origin)}${s}`:i=s}a=new URL(i)?.pathname}else a=n.lastElementChild.textContent?.trim();return!0}),a},H=()=>{let{doc:e}=d(),t=L("image")||L("cardimage")||L("cardimagepath")||e.querySelector("main")?.querySelector("img")?.src.replace(/\?.*/,"")||e.querySelector('meta[property="og:image"]')?.content;return t?j(t):null},fe=()=>{if(E().cardimage)return"";let t=H(),a=new URL(t).pathname.split("/").pop();return d().doc.querySelector(`img[src*="${a}"]`)?.alt},ge=e=>{let t=[];return e.badgeimage&&t.push({type:"image",value:j(e.badgeimage)}),e.badgetext&&t.push({type:"text",value:e.badgetext}),t},q=async()=>{let{branch:e,repo:t,owner:a}=d();if(!(e||t||a)&&window.location.hostname.endsWith(".hlx.page")&&([e,t,a]=window.location.hostname.split(".")[0].split("--")),!(e||t||a))throw new Error(`Branch, Repo or Owner is not set - branch: ${e}, repo: ${t}, owner: ${a}`);let n=await fetch(`${Y}/${a}/${t}/${e}${window.location.pathname}`);return n.ok?(await n.json()).live.status===200:!1},pe=async e=>{let{getLocale:t}=d();if(!t){let{getLocale:a}=await import("./utils-57TVUEB7.js");t=a,$({getLocale:t})}return t(x,e.prodUrl).ietf},R=async e=>{let a=(window.location.pathname==="/tools/send-to-caas/bulkpublisher.html"?await pe(e):(x[window.location.pathname.split("/")[1]]||x[""]).ietf)?.toLowerCase().split("-")||[],[n="en",r="us"]=a;return{country:r,lang:n}},E=()=>{let e={},t=d().doc.querySelector(".caas-marquee-metadata"),n=d().doc.querySelector(".card-metadata")||t,r=["description"];return n&&n.childNodes.forEach(o=>{let i=o.children?.[0]?.textContent?.toLowerCase(),s=o.children?.[1]?.textContent;t&&r.includes(i)&&(s=o.children?.[1]?.innerHTML),i&&(e[i]=s)}),e};function O(e,t,a){if(e?.trim()==="")return"";let n=e||t.prodUrl||window.location.origin+window.location.pathname;return T(n,`Invalid Cta${a}Url: ${n}`)}var me={arbitrary:e=>re(e).map(t=>t),badgeimage:()=>L("badgeimage"),badgetext:0,bookmarkaction:0,bookmarkenabled:(e="")=>{if(e){let t=e.toLowerCase();if(t==="true"||t==="on"||t==="yes")return!0}},bookmarkicon:0,carddescription:0,cardtitle:0,cardimage:()=>H(),cardimagealttext:e=>e||fe(),contentid:(e,t)=>S(t.prodUrl),contenttype:e=>e||C("property","og:type")||d().contentType,country:async(e,t)=>{if(e)return e;let{country:a}=await R(t);return a},created:e=>{if(e)return m(e,`Invalid Created Date: ${e}`);let t=E()?.carddate;if(t)return m(t,`Invalid Date: ${t}`);let a=C("name","publishdate")||C("name","publication-date"),{doc:n,lastModified:r}=d();return a?m(a,`publication-date metadata is not a valid date: ${a}`):m(r||n.lastModified,`document.lastModified is not a valid date: ${n.lastModified}`)},cta1icon:e=>T(e,`Invalid Cta1Icon url: ${e}`),cta1style:0,cta1target:0,cta1text:0,cta1url:(e,t)=>O(e,t,1),cta2icon:e=>T(e,`Invalid Cta2Icon url: ${e}`),cta2style:0,cta2target:0,cta2text:0,cta2url:e=>O(e,{},2),description:e=>e||C("name","description")||"",details:0,entityid:(e,t)=>{let a=t.floodgatecolor||w("floodgatecolor")||"",n=a==="default"||a===""?"":a;return S(`${t.prodUrl}${n}`)},env:e=>e||"",eventduration:0,eventend:e=>m(e,`Invalid Event End Date: ${e}`),eventstart:e=>m(e,`Invalid Event Start Date: ${e}`),floodgatecolor:(e,t)=>e||t.floodgatecolor||w("floodgatecolor")||"default",lang:async(e,t)=>{if(e)return e;let{lang:a}=await R(t);return a},modified:e=>{let{doc:t,lastModified:a}=d();return e?m(e,`Invalid Modified Date: ${e}`):m(a||t.lastModified,`document.lastModified is not a valid date: ${t.lastModified}`)},origin:(e,t)=>{if(e)return e;let a=t.floodgatecolor||w("floodgatecolor");return de(a)},playurl:e=>T(e,`Invalid PlayURL: ${e}`),primarytag:e=>{let t=N(e);return t?{id:t.tagID}:{}},style:e=>e||"default",tags:e=>ce(e),title:e=>e||C("property","og:title")||"",uci:(e,t)=>e||t.prodUrl||window.location.pathname,url:(e,t)=>{let a=e||t.prodUrl||window.location.origin+window.location.pathname;return T(a,`Invalid URL: ${a}`)}},W=e=>({entityId:e.entityid,contentId:e.contentid,contentType:e.contenttype,environment:e.env,url:e.url,floodGateColor:e.floodgatecolor,universalContentIdentifier:e.uci,title:e.cardtitle||e.title,description:e.carddescription||e.description,createdDate:e.created,modifiedDate:e.modified,tags:e.tags,primaryTag:e.primarytag,...e.cardimage&&{thumbnail:{altText:e.cardimagealttext,url:e.cardimage}},country:e.country,language:e.lang,cardData:{style:e.style,headline:e.cardtitle||e.title,...e.details&&{details:e.details},...(e.bookmarkenabled||e.bookmarkicon||e.bookmarkaction)&&{bookmark:{enabled:e.bookmarkenabled,bookmarkIcon:e.bookmarkicon,action:e.bookmarkaction}},badges:ge(e),...e.playurl&&{playUrl:e.playurl},...(e.cta1url||e.cta2url)&&{cta:{...e.cta1url&&{primaryCta:{text:e.cta1text,url:e.cta1url,style:e.cta1style,icon:e.cta1icon,target:e.cta1target}},...e.cta2url&&{secondaryCta:{text:e.cta2text,url:e.cta2url,style:e.cta2style,icon:e.cta2icon,target:e.cta2target}}}},...(e.eventduration||e.eventstart||e.eventend)&&{event:{duration:e.eventduration,startDate:e.eventstart,endDate:e.eventend}}},origin:e.origin,...e.arbitrary?.length&&{arbitrary:e.arbitrary}}),he=async(e,t)=>{let a={},n=[],r=[],o=[];for(let[i,s]of Object.entries(me)){let l=s?await s(e[i],t):e[i];l?.error?n.push(l.error):l?.tagErrors!==void 0?(r=l.tagErrors,a[i]=l.tags,o=l.tags.map(f=>f.id)):l!==void 0&&(a[i]=l)}return!a.contenttype&&o.length&&(a.contenttype=o.find(i=>i.startsWith("caas:content-type"))),{caasMetadata:a,errors:n,tags:o,tagErrors:r}},k=async e=>{let t=E();return he(t,e)},z=async({accessToken:e,caasEnv:t,caasProps:a,draftOnly:n})=>{let r={method:"POST",body:JSON.stringify(a),headers:{Authorization:`Bearer ${e}`,draft:!!n,"caas-env":t}},o,i=await fetch(ee,r);if(i!==void 0){let s=await i.text();try{o=JSON.parse(s)}catch{o=s}}return o};var[ye,g,we]=(()=>{let e=!1;return[()=>{e=!0},()=>{e=!1},()=>e]})(),be=async(e,t)=>{window.tingle?.modal||await Promise.all([e("https://milo.adobe.com/libs/deps/tingle.js"),t("https://milo.adobe.com/libs/deps/tingle.css")])},h=(e,{error:t=!1,onClose:a,showBtn:n=!0,btnText:r="OK"}={})=>{let o=new tingle.modal({footer:!0,closeMethods:["overlay","escape"],onClose(){a&&a(),this.destroy()}}),i=e;return t&&(i=`<div class="modal-error"><div class="modal-alert"></div><div>${e}</div></div>`),o.setContent(i),n&&o.addFooterBtn(r,"tingle-btn tingle-btn--primary tingle-btn--pull-right",()=>o.close()),o.open(),o},v=(e,{onClose:t,cssClass:a=[],ctaBtnType:n="primary",ctaText:r="OK",cancelBtnType:o="default",cancelText:i="Cancel",footerContent:s="",initCode:l,leftButton:f}={})=>new Promise(p=>{let u=!1,c=new tingle.modal({cssClass:a,footer:!0,closeMethods:["escape"],onClose(){t&&t(this),this.destroy(),p(u)}});c.setContent(e),s&&c.setFooterContent(s),r&&c.addFooterBtn(r,`tingle-btn tingle-btn--${n} tingle-btn--pull-right`,()=>{u=!0,c.close()}),c.addFooterBtn(i,`tingle-btn tingle-btn--${o} tingle-btn--pull-right`,()=>{u=!1,c.close()}),f&&c.addFooterBtn(f.text,"tingle-btn tingle-btn--default tingle-btn--pull-left",()=>{f.callback?.()}),l&&l(c.modal),c.open()}),Ce=()=>{let e=new tingle.modal({closeMethods:[],cssClass:["modal-text-align-center"],onClose(){this.destroy()}});return e.setContent("Publishing to CaaS..."),e.open(),e},Te=async(e,t,a)=>{let n=!1,r=!1,o=!1,i,s={text:"See all properties",callback:a},l=`
    <div class="verify-info-footer">
      <div class="caas-env">
        <label for="caas-env-select">CaaS Env</label>
        <select name="1A" id="caas-env-select">
          <option>Prod</option>
          <option>Stage</option>
          <option>Dev</option>
        </select>
      </div>
      <div id="caas-draft-cb">
        <input type="checkbox" id="draftcb" name="draftcb">
        <label for="draftcb">Publish to Draft only</label>
      </div>
      <div id="caas-use-html-cb" class="field checkbox">
        <input type="checkbox" id="usehtml" name="usehtml">
        <label for="usehtml">Use .html extension</label>
      </div>
    </div>`,f=()=>{i=document.getElementById("caas-env-select")?.value?.toLowerCase(),r=document.getElementById("draftcb")?.checked,o=document.getElementById("usehtml")?.checked},p=u=>{let c=u.querySelector("#caas-env-select"),y=c.value?.toLowerCase(),P=u.querySelector("#usehtml");y==="prod"&&(P.checked=!0),c.addEventListener("change",V=>{P.checked=V.target.value?.toLowerCase()==="prod"})};if(!e.length)n=await v("<div><p><b>No Tags found on page</b></p><p>Please add at least one tag to the Card Metadata</p></div>",{cssClass:["verify-info-modal"],ctaText:"",cancelBtnType:"danger",cancelText:"Cancel Registration",footerContent:l,leftButton:s,onClose:f});else if(t.length){let u=['<div class="">',"<p><b>The following tags were not found:</b></p>",t.join("<br>"),"<p><b>Ok to publish without those tags defined?</b></p>","<p>The following tags will be used:</p>",e.join("<br>"),"</div>"].join("");n=await v(u,{cssClass:["verify-info-modal"],ctaText:"Publish with missing tags",cancelBtnType:"grey",cancelText:"Cancel Registration",ctaBtnType:"danger",footerContent:l,initCode:p,leftButton:s,onClose:f})}else{let u=["<div><p><b>The following tags will be used:</b></p>",e.join("<br>"),"<p><b>Please verify that these are correct.</b></p></div>"].join("");n=await v(u,{cssClass:["verify-info-modal"],cancelBtnType:"grey",cancelText:"Cancel Registration",ctaText:"Continue with these tags",footerContent:l,initCode:p,leftButton:s,onClose:f})}return{caasEnv:i,draftOnly:r,okToContinue:n,useHtml:o}},ve=()=>document.getElementById("usehtml")?.checked,Se=e=>Object.keys(e).sort().reduce((t,a)=>(t[a]=e[a],t),{}),xe=async(e,t)=>{let{caasMetadata:a,errors:n,tags:r,tagErrors:o}=await k({prodUrl:`${e}${window.location.pathname}`}),i=async()=>{let{caasMetadata:c}=await k({prodUrl:`${e}${window.location.pathname}${ve()?".html":""}`}),y=JSON.stringify(Se(c),void 0,4);h(`<h3>All CaaS Properties</h3><pre id="json" style="white-space:pre-wrap;font-size:14px;">${y}</pre>`)},{draftOnly:s,caasEnv:l,okToContinue:f,useHtml:p}=await Te(r,o,i);if(!f)return g(),t.close(),!1;if(n.length){t.close();let c=["<p>There were problems with the following:</p>",n.join("<br>"),"<p>Publishing to CaaS aborted, please fix errors and try again.</p>"].join("");return h(c,{error:!0,onClose:g}),!1}let u;return p&&({caasMetadata:u}=await k({prodUrl:`${e}${window.location.pathname}.html`})),{caasEnv:l,caasMetadata:u||a,draftOnly:s}},Le=async e=>await q()?!0:(e.close(),h("Page must be published before it can be registered with CaaS.<br>Please publish the page and try again.",{error:!0}),g(),!1),ke=async(e,t)=>{let a=await D(t);if(!a){if(e.close(),await v(`You must be logged in with an Adobe ID in order to publish to CaaS.
Do you want to log in?`)){let{signInContext:r}=d();window.adobeIMS.signIn(r)}return g(),!1}return a},Ie=async({accessToken:e,caasEnv:t,caasProps:a,draftOnly:n,publishingModal:r})=>{try{let o=await z({accessToken:e,caasEnv:t,caasProps:a,draftOnly:n});if(r.close(),o.success)h(`<p>Successfully published page to CaaS!<p><p>Card ID: ${a.entityId}</p>`,{onClose:g});else if(o.error?.startsWith("Invalid User: Not an Adobe employee")){let s=await v("Please login with your Adobe company account.  Do you want to try logging in again?",{cancelBtnType:"grey",cancelText:"Cancel",ctaText:"Login"});if(g(),s){let{signInContext:l}=d();window.adobeIMS.signIn(l)}}else h(o.message||o.error||JSON.stringify(o),{error:!0,onClose:g})}catch(o){r.close(),g(),h(`Error posting to CaaS:<br>${o.message}`,{error:!0})}},G=()=>{},ze=async({host:e="",project:t="",branch:a="",repo:n="",owner:r=""}={},o=G,i=G)=>{if(we())return;if(await be(o,i),window.adobeid?.environment!=="prod"){h("Send to CaaS needs to reload the page with prod IMS setup.  Please try again after reload.",{onClose:()=>{let l=new URL(window.location);l.searchParams.append("env","prod"),window.location.assign(l)}});return}$({host:e||window.location.host,project:t,branch:a,repo:n,owner:r,doc:document}),i("https://milo.adobe.com/tools/send-to-caas/send-to-caas.css"),ye();let s=Ce();try{if(!e)throw new Error("host must be specified");await _();let{caasEnv:l,caasMetadata:f,draftOnly:p}=await xe(e,s);if(!f||!await Le(s))return;let c=await ke(s,o);if(!c)return;let y=W(f);Ie({accessToken:c,caasEnv:l,caasProps:y,draftOnly:p,publishingModal:s})}catch(l){g(),s.close(),h(`ERROR: ${l.message}`,{error:!0})}};export{be as loadTingleModalFiles,ze as sendToCaaS,h as showAlert,v as showConfirm};
