import{B as h,C as y,e as L,g as a,i as b,r as v,s as l}from"./chunk-VLPXW364.js";import{a as m}from"./chunk-P5BLQZYT.js";import{b as f}from"./chunk-NY3PBGKK.js";import"./chunk-TXSFCJFB.js";import"./chunk-I5JF36TS.js";import{f as c}from"./chunk-VP5VJMKQ.js";import"./chunk-YBWLHNHN.js";var t={suggestions:{scope:"adobecom",apiKey:"adobedotcom2"},selectors:{hasResults:"has-results",inputIsPopulated:"feds-search-input--isPopulated"}},{locale:u}=c(),[,q="US"]=u.ietf.split("-"),d=class o{constructor(e){this.icon=e.icon,this.trigger=e.trigger,this.parent=this.trigger.closest(".feds-nav-wrapper"),new MutationObserver(()=>{this.clearSearchForm()}).observe(this.trigger,{attributeFilter:["aria-expanded"]}),L(this.init.bind(this),"Search init has failed","errorType=error,module=gnav-search")}async init(){await this.getLabels(),this.decorate(),this.addEventListeners(),this.toggleDropdown()}async getLabels(){this.labels={},[this.labels.search,this.labels.clearResults,this.labels.tryAdvancedSearch]=await f(["search","clear-results","try-advanced-search"],b())}decorate(){this.input=a`<input placeholder="${this.labels.search}" aria-label="${this.labels.search}" class="feds-search-input" autocomplete="off" aria-autocomplete="list" aria-controls="feds-search-results" daa-ll="search-results:standard search" />`,this.resultsList=a`<ul class="feds-search-results" id="feds-search-results" role="region" daa-ll="search-results:suggested-search:click"></ul>`,this.clearButton=a`<button tabindex="0" class="feds-search-clear" aria-label="${this.labels.clearResults}"></button>`,this.searchBar=a`
      <aside class="feds-search-dropdown">
        <div class="feds-search-bar">
          <div class="feds-search-field">
            ${this.input}
            <div class="feds-search-icons">
              ${this.icon}
              ${this.clearButton}
            </div>
          </div>
          ${this.resultsList}
        </div>
      </aside>`,this.trigger.after(this.searchBar)}clearSearchForm(){this.input.value="",this.onSearchInput()}addEventListeners(){this.trigger.addEventListener("click",()=>{this.toggleDropdown()}),this.input.addEventListener("input",()=>{this.onSearchInput()}),this.input.addEventListener("keydown",e=>{if(e.code==="Escape"&&(this.input.value.length?this.clearSearchForm():l.matches&&(h(),this.trigger.focus())),e.code==="Enter"){if(!this.query)return;window.location.href=o.getHelpxLink(this.query)}}),this.resultsList.addEventListener("keydown",e=>{e.code==="Escape"&&this.input.focus()}),this.clearButton.addEventListener("click",()=>{this.clearSearchForm(),this.input.focus()}),l.addEventListener("change",()=>{h()})}getSuggestions(e=this.query){let{env:s}=c(),r=`https://${s==="prod"?"adobesearch":"adobesearch-stage"}.adobe.io/autocomplete/completions?q[locale]=${u.ietf}&scope=${t.suggestions.scope}&q[text]=${encodeURIComponent(e)}`;return fetch(r,{headers:{"x-api-key":t.suggestions.apiKey}}).then(p=>p.json()).catch(()=>{})}onSearchInput=m(()=>{let e=this.getQuery();if(!e.length){this.resultsList.replaceChildren(),delete this.query;return}e!==this.query&&(this.query=e,this.getSuggestions().then(s=>{let n=s?.suggested_completions;if(!Array.isArray(n)||!n.length){this.resultsList.replaceChildren(this.getNoResultsTemplate()),this.parent instanceof HTMLElement&&this.parent.classList.remove(t.selectors.hasResults);return}this.resultsList.replaceChildren(this.getResultsTemplate(n)),this.parent instanceof HTMLElement&&this.parent.classList.add(t.selectors.hasResults)}).catch(()=>{this.resultsList.replaceChildren(this.getNoResultsTemplate()),this.parent instanceof HTMLElement&&this.parent.classList.remove(t.selectors.hasResults)}))},150);getQuery(){let e=this.input.value.trim();return e.length?(this.input.classList.add(t.selectors.inputIsPopulated),e):(this.input.classList.remove(t.selectors.inputIsPopulated),this.resultsList.replaceChildren(),this.parent instanceof HTMLElement&&this.parent.classList.remove(t.selectors.hasResults),"")}getResultsTemplate(e){let s=document.createDocumentFragment();return e.map(n=>{let r=n.name;if(!r.length)return;let $=(()=>{let i=0,S=this.query.length;for(;i<S&&this.query[i].toLowerCase()===r[i].toLowerCase();)i+=1;return this.query.substring(0,i).trim()})(),x=new RegExp(`(${$})`,"i"),g,w=r.replace(x,i=>(g=i,"")),E=a`<li>
          <a href="${o.getHelpxLink(r)}" class="feds-search-result" aria-label="${r}">
            <span>${g}</span>${w}
          </a>
        </li>`;s.appendChild(E)}),s}getNoResultsTemplate(e=this.query){return a`<li>
      <a href="${o.getHelpxLink(e)}" class="feds-search-result"><span>${this.labels.tryAdvancedSearch}</span></a>
    </li>`}focusInput(){l.matches&&this.input.focus()}toggleDropdown(){if(!l.matches)return;y({element:this.trigger})?(v(!0),this.focusInput()):this.clearSearchForm()}static getHelpxLink(e){return`https://helpx.adobe.com${u.prefix}/globalsearch.html?q=${encodeURIComponent((e||"").trim())}&start_index=0&country=${q}`}},F=d;export{F as default};
