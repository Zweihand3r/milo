import"./chunk-YBWLHNHN.js";function $(i,a,c){i.filter(o=>!(a.end<o.start||a.start>o.end)).length===0&&i.length<c&&i.push(a)}async function b(i,a,c=1e3){let d=["zh","ko","ja","th","he"].includes(a),o=document.querySelector("main"),g=await fetch(`${i}?limit=${c}`);if(!(o&&g.ok))return;let u=await g.json(),x=o.textContent.toLowerCase(),A=o.querySelectorAll("a").length,E=x.split(/\s/).length;if(Math.floor(E/100)-A<=0)return;let y=d?"":"\\b",l=(Array.isArray(u)?u:u.data).filter(({Keyword:e})=>x.indexOf(e.toLowerCase())!==-1).sort((e,f)=>f.Keyword.length-e.Keyword.length).map(e=>({regexp:new RegExp(`${y}(${e.Keyword.replace(/[/\\^$*+?.()|[\]{}]/g,"\\$&")})${y}`,"iu"),...e}));l.length!==0&&o.querySelectorAll("div > p:not([class])").forEach(e=>{let f=e.querySelectorAll("a").length,L=e.textContent.split(/\s/).length,p=Math.floor(L/40)-f;(d||p>0)&&Array.from(e.childNodes).filter(s=>s.nodeType===Node.TEXT_NODE).forEach(s=>{let w=[];l.forEach(t=>{let n=t.regexp.exec(s.nodeValue);n&&$(w,{item:t,start:n.index,end:n.index+t.Keyword.length},p)}),w.sort((t,n)=>n.start-t.start).forEach(({item:t,start:n,end:k})=>{let h=s.nodeValue,r=document.createElement("a");r.title=t.Keyword,r.href=t.URL,r.setAttribute("data-origin","interlink"),r.setAttribute("daa-ll",`${r.title}--interlinks_p_${t.Keyword}`),r.appendChild(document.createTextNode(h.substring(n,k))),e.insertBefore(r,s.nextSibling),e.insertBefore(document.createTextNode(h.substring(k)),r.nextSibling),s.nodeValue=h.substring(0,n),l.splice(l.indexOf(t),1)})})})}export{$ as checkAndAddMatch,b as default};
