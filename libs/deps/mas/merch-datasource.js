var C=window.adobeid?.authorize?.(),d={Authorization:`Bearer ${C}`,pragma:"no-cache","cache-control":"no-cache"};async function b({path:e,query:t,variant:s}){let n={};e&&(n.path=e),t&&(n.fullText={text:encodeURIComponent(t),queryMode:"EXACT_WORDS"});let o=new URLSearchParams({query:JSON.stringify({filter:n})}).toString();return fetch(`${this.cfSearchUrl}?${o}`,{headers:d}).then(c=>c.json()).then(c=>c.items).then(c=>s?c.filter(a=>{let[r]=a.fields.find(i=>i.name==="variant")?.values;return r===s}):c)}async function _(e){return fetch(`${this.cfFragmentsUrl}?path=${e}`).then(t=>t.json()).then(({items:[t]})=>t)}var g=async e=>{let t=e.headers.get("Etag"),s=await e.json();return s.etag=t,s};async function E(e){return await fetch(`${this.cfFragmentsUrl}/${e}`,{headers:d}).then(g)}async function N(e){let{title:t,fields:s}=e;return await fetch(`${this.cfFragmentsUrl}/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json","If-Match":e.etag,...d},body:JSON.stringify({title:t,fields:s})}).then(g)}async function w(e){let t=await this.getCsrfToken(),s=e.path.split("/").pop(),n=e.path.split("/").slice(0,-1).join("/");if(/copy\s?\d?/.test(e.title)){let c=e.name.match(/copy\s?(\d)?/)[1]||1;s=e.name.replace(/copy\s?\d?/,`copy ${++c}`)}else s=`${s}-copy-1`;let o=new FormData;return o.append("cmd","copyPage"),o.append("srcPath",e.path),o.append("destParentPath",n),o.append("shallow","false"),o.append("_charset_","UTF-8"),o.append("destName",s),o.append("destTitle",e.title),await fetch(this.wcmcommandUrl,{method:"POST",headers:{...d,"csrf-token":t},body:o}).then(c=>{if(c.ok)return E(e.path)})}async function A(e){await fetch(this.cfPublishUrl,{method:"POST",headers:{"Content-Type":"application/json","If-Match":e.etag,...d},body:JSON.stringify({paths:[e.path],filterReferencesByStatus:["DRAFT","UNPUBLISHED"],workflowModelId:"/var/workflow/models/scheduled_activation_with_references"})})}async function R(e){await fetch(`${this.cfFragmentsUrl}/${e.id}`,{method:"DELETE",headers:{"Content-Type":"application/json","If-Match":e.etag,...d}})}var f=class{async getCsrfToken(){let{token:t}=await fetch(this.csrfTokenUrl,{headers:d}).then(s=>s.json());return t}sites={cf:{fragments:{search:b.bind(this),getCfByPath:_.bind(this),getCfById:E.bind(this),save:N.bind(this),copyFragment:w.bind(this),publish:A.bind(this),delete:R.bind(this)}}};constructor(t){let s=`https://${t}.adobeaemcloud.com`,n=`${s}/adobe/sites`;this.cfFragmentsUrl=`${n}/cf/fragments`,this.cfSearchUrl=`${this.cfFragmentsUrl}/search`,this.cfPublishUrl=`${this.cfFragmentsUrl}/publish`,this.wcmcommandUrl=`${s}/bin/wcmcommand`,this.csrfTokenUrl=`${s}/libs/granite/csrf/token.json`}};function l(e,t={},s){let n=document.createElement(e);s instanceof HTMLElement?n.appendChild(s):n.innerHTML=s;for(let[o,c]of Object.entries(t))n.setAttribute(o,c);return n}var T="aem-bucket";var M={catalog:{title:{tag:"h3",slot:"heading-xs"},prices:{tag:"h3",slot:"heading-xs"},description:{tag:"div",slot:"body-xs"},ctas:{size:"l"}},ah:{title:{tag:"h3",slot:"heading-xxs"},prices:{tag:"h3",slot:"heading-xs"},description:{tag:"div",slot:"body-xxs"},ctas:{size:"s"}},"ccd-action":{title:{tag:"h3",slot:"heading-xs"},prices:{tag:"h3",slot:"heading-xs"},description:{tag:"div",slot:"body-xs"},ctas:{size:"l"}},"special-offers":{name:{tag:"h4",slot:"detail-m"},title:{tag:"h4",slot:"detail-m"},backgroundImage:{tag:"div",slot:"bg-image"},prices:{tag:"h3",slot:"heading-xs"},description:{tag:"div",slot:"body-xs"},ctas:{size:"l"}}};async function S(e,t,s,n){let o=e.fields.reduce((r,{name:i,multiple:h,values:p})=>(r[i]=h?p:p[0],r),{id:e.id});o.path=o.path,o.model=o.model;let{variant:c="catalog"}=o;s.setAttribute("variant",c);let a=M[c]??"catalog";if(o.icon?.forEach(r=>{let i=l("merch-icon",{slot:"icons",src:r,alt:"",href:"",size:"l"});t(i)}),o.title&&a.title&&t(l(a.title.tag,{slot:a.title.slot},o.title)),o.backgroundImage&&a.backgroundImage&&t(l(a.backgroundImage.tag,{slot:a.backgroundImage.slot},`<img loading="lazy" src="${o.backgroundImage}" width="600" height="362">`)),o.prices&&a.prices){let r=o.prices,i=l(a.prices.tag,{slot:a.prices.slot},r);t(i)}if(o.description&&a.description){let r=l(a.description.tag,{slot:a.description.slot},o.description);t(r)}if(o.ctas){let r=o.ctas,i=l("div",{slot:"footer"},r);[...i.querySelectorAll("a")].forEach(h=>{if(n)h.classList.add("con-button"),h.parentElement.tagName==="STRONG"&&h.classList.add("blue"),i.appendChild(h);else{let p=l("sp-button",{},h);p.addEventListener("click",y=>{y.stopPropagation(),h.click()}),i.appendChild(p)}}),t(i)}}var m=class{#t=new Map;clear(){this.#t.clear()}add(...t){t.forEach(s=>{let{path:n}=s;n&&this.#t.set(n,s)})}has(t){return this.#t.has(t)}get(t){return this.#t.get(t)}remove(t){this.#t.delete(t)}},x=new m,u=class extends HTMLElement{#t;cache=x;refs=[];path;consonant=!1;static get observedAttributes(){return["source","path","consonant"]}attributeChangedCallback(t,s,n){this[t]=n}connectedCallback(){this.consonant=this.hasAttribute("consonant"),this.clearRefs();let t=this.getAttribute(T)??document.querySelector("mas-studio")?.getAttribute(T)??"publish-p22655-e59341";this.#t=new f(t),this.fetchData()}clearRefs(){this.refs.forEach(t=>{t.remove()})}refresh(t=!0){this.clearRefs(),this.refs=[],t&&this.cache.remove(this.path),this.fetchData()}async fetchData(){let t=x.get(this.path);if(t||(t=await this.#t.sites.cf.fragments.getCfByPath(this.path)),t){S(t,n=>{this.parentElement.appendChild(n),this.refs.push(n)},this.parentElement,this.consonant);return}}};customElements.define("merch-datasource",u);export{u as MerchDataSource};
//# sourceMappingURL=merch-datasource.js.map
