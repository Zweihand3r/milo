var C=window.adobeid?.authorize?.(),d={Authorization:`Bearer ${C}`,pragma:"no-cache","cache-control":"no-cache"};async function b({path:s,query:t,variant:o}){let n={};s&&(n.path=s),t&&(n.fullText={text:encodeURIComponent(t),queryMode:"EXACT_WORDS"});let e=new URLSearchParams({query:JSON.stringify({filter:n})}).toString();return fetch(`${this.cfSearchUrl}?${e}`,{headers:d}).then(a=>a.json()).then(a=>a.items).then(a=>o?a.filter(c=>{let[i]=c.fields.find(r=>r.name==="variant")?.values;return i===o}):a)}async function _(s){return fetch(`${this.cfFragmentsUrl}?path=${s}`).then(t=>t.json()).then(({items:[t]})=>t)}var u=async s=>{let t=s.headers.get("Etag"),o=await s.json();return o.etag=t,o};async function E(s){return await fetch(`${this.cfFragmentsUrl}/${s}`,{headers:d}).then(u)}async function N(s){let{title:t,fields:o}=s;return await fetch(`${this.cfFragmentsUrl}/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json","If-Match":s.etag,...d},body:JSON.stringify({title:t,fields:o})}).then(u)}async function w(s){let t=await this.getCsrfToken(),o=s.path.split("/").pop(),n=s.path.split("/").slice(0,-1).join("/");if(/copy\s?\d?/.test(s.title)){let a=s.name.match(/copy\s?(\d)?/)[1]||1;o=s.name.replace(/copy\s?\d?/,`copy ${++a}`)}else o=`${o}-copy-1`;let e=new FormData;return e.append("cmd","copyPage"),e.append("srcPath",s.path),e.append("destParentPath",n),e.append("shallow","false"),e.append("_charset_","UTF-8"),e.append("destName",o),e.append("destTitle",s.title),await fetch(this.wcmcommandUrl,{method:"POST",headers:{...d,"csrf-token":t},body:e}).then(a=>{if(a.ok)return E(s.path)})}async function A(s){await fetch(this.cfPublishUrl,{method:"POST",headers:{"Content-Type":"application/json","If-Match":s.etag,...d},body:JSON.stringify({paths:[s.path],filterReferencesByStatus:["DRAFT","UNPUBLISHED"],workflowModelId:"/var/workflow/models/scheduled_activation_with_references"})})}async function R(s){await fetch(`${this.cfFragmentsUrl}/${s.id}`,{method:"DELETE",headers:{"Content-Type":"application/json","If-Match":s.etag,...d}})}var f=class{async getCsrfToken(){let{token:t}=await fetch(this.csrfTokenUrl,{headers:d}).then(o=>o.json());return t}sites={cf:{fragments:{search:b.bind(this),getCfByPath:_.bind(this),getCfById:E.bind(this),save:N.bind(this),copyFragment:w.bind(this),publish:A.bind(this),delete:R.bind(this)}}};constructor(t){let o=`https://${t}.adobeaemcloud.com`,n=`${o}/adobe/sites`;this.cfFragmentsUrl=`${n}/cf/fragments`,this.cfSearchUrl=`${this.cfFragmentsUrl}/search`,this.cfPublishUrl=`${this.cfFragmentsUrl}/publish`,this.wcmcommandUrl=`${o}/bin/wcmcommand`,this.csrfTokenUrl=`${o}/libs/granite/csrf/token.json`}};function h(s,t={},o){let n=document.createElement(s);o instanceof HTMLElement?n.appendChild(o):n.innerHTML=o;for(let[e,a]of Object.entries(t))n.setAttribute(e,a);return n}var x="aem-bucket",M={"8a7b6c5d-4e3f-2a1b-9c8d-7e6f5a4b3c2d":"photoshop-lapsed-upgrade","a1b2c3d4-e5f6-7890-abcd-ef1234567890":"photography-upsell"};var S={catalog:{title:{tag:"h3",slot:"heading-xs"},prices:{tag:"h3",slot:"heading-xs"},description:{tag:"div",slot:"body-xs"},ctas:{size:"l"}},ah:{title:{tag:"h3",slot:"heading-xxs"},prices:{tag:"h3",slot:"heading-xs"},description:{tag:"div",slot:"body-xxs"},ctas:{size:"s"}},"ccd-action":{title:{tag:"h3",slot:"heading-xs"},prices:{tag:"h3",slot:"heading-xs"},description:{tag:"div",slot:"body-xs"},ctas:{size:"l"}},"special-offers":{name:{tag:"h4",slot:"detail-m"},title:{tag:"h4",slot:"detail-m"},backgroundImage:{tag:"div",slot:"bg-image"},prices:{tag:"h3",slot:"heading-xs"},description:{tag:"div",slot:"body-xs"},ctas:{size:"l"}}};async function $(s,t,o,n){let e=s.fields.reduce((i,{name:r,multiple:l,values:p})=>(i[r]=l?p:p[0],i),{id:s.id});e.path=e.path,e.model=e.model;let{variant:a="catalog"}=e;o.setAttribute("variant",a);let c=S[a]??"catalog";if(e.icon?.forEach(i=>{let r=h("merch-icon",{slot:"icons",src:i,alt:"",href:"",size:"l"});t(r)}),e.title&&c.title&&t(h(c.title.tag,{slot:c.title.slot},e.title)),e.backgroundImage&&c.backgroundImage&&t(h(c.backgroundImage.tag,{slot:c.backgroundImage.slot},`<img loading="lazy" src="${e.backgroundImage}" width="600" height="362">`)),e.prices&&c.prices){let i=e.prices,r=h(c.prices.tag,{slot:c.prices.slot},i);t(r)}if(e.description&&c.description){let i=h(c.description.tag,{slot:c.description.slot},e.description);t(i)}if(e.ctas){let i=e.ctas,r=h("div",{slot:"footer"},i);[...r.querySelectorAll("a")].forEach(l=>{if(n)l.classList.add("con-button"),l.parentElement.tagName==="STRONG"&&l.classList.add("blue"),r.appendChild(l);else{let p=h("sp-button",{},l);p.addEventListener("click",y=>{y.stopPropagation(),l.click()}),r.appendChild(p)}}),t(r)}}var m=class{#t=new Map;clear(){this.#t.clear()}add(...t){t.forEach(o=>{let{path:n}=o;n&&this.#t.set(n,o)})}has(t){return this.#t.has(t)}get(t){return this.#t.get(t)}remove(t){this.#t.delete(t)}},T=new m,g=class extends HTMLElement{#t;cache=T;refs=[];path;consonant=!1;static get observedAttributes(){return["source","path","consonant"]}attributeChangedCallback(t,o,n){this[t]=n}connectedCallback(){this.consonant=this.hasAttribute("consonant"),this.clearRefs();let t=this.getAttribute(x)??document.querySelector("mas-studio")?.getAttribute(x)??"publish-p22655-e59341";this.#t=new f(t),this.fetchData()}clearRefs(){this.refs.forEach(t=>{t.remove()})}refresh(t=!0){this.clearRefs(),this.refs=[],t&&this.cache.remove(this.path),this.fetchData()}async fetchData(){let t=T.get(this.path);t||(t=await this.#t.sites.cf.fragments.getCfByPath(this.path));let o=(sessionStorage.getItem("mas_xlg")??window.alloy_all?.data?._adobe_corpnew?.digitalData?.adobe?.xlg)?.split(",")?.map(e=>M[e]).find(Boolean),n=t.fields.find(e=>e.name==="xlg")?.values[0];if(o&&n?.includes(o)){let e=await this.#t.sites.cf.fragments.getCfByPath(`${this.path}-${o}`).catch(()=>null);e&&(t=e)}if(t){$(t,a=>{this.parentElement.appendChild(a),this.refs.push(a)},this.parentElement,this.consonant);return}}};customElements.define("merch-datasource",g);export{g as MerchDataSource};
//# sourceMappingURL=merch-datasource.js.map
